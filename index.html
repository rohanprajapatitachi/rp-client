<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Todo List</title>
    <style>
        /* Basic CSS for table styling */
        table {
            width: 80%;
            margin-left: auto;
            margin-right: auto;
        }

        th,
        td {
            border-bottom: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }

        th {
            background-color: #f2f2f2;
        }

        tr:hover {
            background-color: #f5f5f5;
        }

        button {
            margin-right: 5px;
        }
    </style>
</head>

<body>
    <h1>Todo List</h1>
    <button onclick="location.href='add.html'">Add New Todo</button>
    <table id="todo-list">
        <thead>
            <tr>
                <th>Title</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            <!-- Todo items will be populated here -->
        </tbody>
    </table>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const listElement = document.querySelector("#todo-list tbody");

            function fetchTodos() {
                fetch("http://localhost:3001/todos/get-all-todos")
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Network response was not ok');
                        }
                        
                        return response.json();
                    })
                    .then(todos => {
                        console.log("todos ~~~~>",todos)
                        listElement.innerHTML = ""; // Clear existing todos
                        todos.forEach(todo => {
                            const row = `<tr>
                                            <td>${todo?.title}</td>
                                            <td>
                                                <button onclick="editTodo('${todo?._id}')">Edit</button>
                                                <button onclick="deleteTodo('${todo?._id}')">Delete</button>
                                            </td>
                                         </tr>`;
                            listElement.innerHTML += row;
                        });
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert("There was an error fetching the todo list.");
                    });
            }

            window.deleteTodo = (id) => {
                localStorage.setItem('editingTodoId', id);
                if (!confirm("Are you sure you want to delete this todo?")) {
                    return;
                }
                fetch(`http://localhost:3001/todos/delete-todo/${id}`, { method: 'DELETE' })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Network response was not ok');
                        }
                        return response.json();
                    })
                    .then(() => fetchTodos()) // Refresh list after delete
                    .catch(error => {
                        console.error('Error:', error);
                        alert("There was an error deleting the todo.");
                    });
            };

            window.editTodo = (id) => {
                // You can either use localStorage or query parameters. Here's using query params for example:
                localStorage.setItem('editingTodoId', id);
                window.location.href = `edit.html?id=${id}`;
            };

            fetchTodos();
        });
    </script>
</body>

</html>